<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è JS DOOM</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #111;
            color: #f80;
            padding: 20px;
            margin: 0;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.8);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #f80;
        }
        
        h1 {
            text-align: center;
            color: #f80;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 136, 0, 0.1);
            border-radius: 10px;
            border: 1px solid #f80;
        }
        
        .test-section h3 {
            color: #f80;
            margin-top: 0;
        }
        
        .key-test {
            display: inline-block;
            background: #f80;
            color: #000;
            padding: 10px 20px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            user-select: none;
        }
        
        .key-test:hover {
            background: #ff6b35;
        }
        
        .key-test:active {
            transform: scale(0.95);
        }
        
        .log {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #333;
            margin-top: 20px;
        }
        
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        
        .log-entry.keydown { background: rgba(0, 255, 0, 0.2); }
        .log-entry.keyup { background: rgba(255, 255, 0, 0.2); }
        .log-entry.info { background: rgba(0, 123, 255, 0.2); }
        
        .status {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #f80;
        }
        
        .status h4 {
            color: #f80;
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üéπ –¢–µ—Å—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è JS DOOM</h1>
        
        <div class="status">
            <h4>üìä –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</h4>
            <div id="status-content">
                <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API...</p>
            </div>
        </div>
        
        <div class="test-section">
            <h3>üéÆ –¢–µ—Å—Ç –¥–≤–∏–∂–µ–Ω–∏—è (—Å—Ç—Ä–µ–ª–∫–∏)</h3>
            <div class="key-test" onclick="testKey('ARROW_UP')">‚Üë –í–≤–µ—Ä—Ö</div>
            <div class="key-test" onclick="testKey('ARROW_DOWN')">‚Üì –í–Ω–∏–∑</div>
            <div class="key-test" onclick="testKey('ARROW_LEFT')">‚Üê –í–ª–µ–≤–æ</div>
            <div class="key-test" onclick="testKey('ARROW_RIGHT')">‚Üí –í–ø—Ä–∞–≤–æ</div>
        </div>
        
        <div class="test-section">
            <h3>üî´ –¢–µ—Å—Ç –¥–µ–π—Å—Ç–≤–∏–π</h3>
            <div class="key-test" onclick="testKey('CTRL')">Ctrl (–°—Ç—Ä–µ–ª—å–±–∞)</div>
            <div class="key-test" onclick="testKey('SPACE')">Space (–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)</div>
        </div>
        
        <div class="test-section">
            <h3>üß™ –¢–µ—Å—Ç API</h3>
            <div class="key-test" onclick="testDosboxAPI()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å js-dos API</div>
            <div class="key-test" onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</div>
        </div>
        
        <div class="log" id="log-content">
            <div class="log-entry info">–°–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞. –ù–∞–∂–º–∏—Ç–µ –∫–ª–∞–≤–∏—à–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.</div>
        </div>
    </div>

    <script>
        let logCounter = 0;
        let dosboxInstance = null;

        // –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        function log(message, type = 'info') {
            const logContent = document.getElementById('log-content');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${++logCounter}] ${message}`;
            logContent.appendChild(entry);
            logContent.scrollTop = logContent.scrollHeight;
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –ª–æ–≥–∞
        function clearLog() {
            document.getElementById('log-content').innerHTML = '';
            logCounter = 0;
            log('–õ–æ–≥ –æ—á–∏—â–µ–Ω', 'info');
        }

        // –§—É–Ω–∫—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª–∞–≤–∏—à
        function testKey(key) {
            log(`–¢–µ—Å—Ç–∏—Ä—É–µ–º –∫–ª–∞–≤–∏—à—É: ${key}`, 'info');
            
            // –°–æ–∑–¥–∞–µ–º —Å–æ–±—ã—Ç–∏–µ –∫–ª–∞–≤–∏—à–∏
            const keyCode = getKeyCode(key);
            if (keyCode !== null) {
                log(`–ö–æ–¥ –∫–ª–∞–≤–∏—à–∏: ${keyCode}`, 'info');
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º keydown
                sendKeyEvent(keyCode, true);
                log(`–û—Ç–ø—Ä–∞–≤–ª–µ–Ω keydown –¥–ª—è ${key}`, 'keydown');
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º keyup —á–µ—Ä–µ–∑ 100–º—Å
                setTimeout(() => {
                    sendKeyEvent(keyCode, false);
                    log(`–û—Ç–ø—Ä–∞–≤–ª–µ–Ω keyup –¥–ª—è ${key}`, 'keyup');
                }, 100);
            } else {
                log(`–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–ª–∞–≤–∏—à–∞: ${key}`, 'info');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–¥–∞ –∫–ª–∞–≤–∏—à–∏
        function getKeyCode(key) {
            const keyMap = {
                'CTRL': 29,
                'SPACE': 57,
                'ARROW_UP': 200,
                'ARROW_DOWN': 208,
                'ARROW_LEFT': 203,
                'ARROW_RIGHT': 205
            };
            return keyMap[key] || null;
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏—è –∫–ª–∞–≤–∏—à–∏
        function sendKeyEvent(keyCode, isDown) {
            try {
                // –ü—ã—Ç–∞–µ–º—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å js-dos API
                if (window.dosbox && window.dosbox.module) {
                    if (window.dosbox.module.shell && window.dosbox.module.shell.sendKeyEvent) {
                        window.dosbox.module.shell.sendKeyEvent(keyCode, isDown);
                        log(`js-dos shell: ${isDown ? 'keydown' : 'keyup'} ${keyCode}`, 'info');
                    } else if (window.dosbox.module.sendKeyEvent) {
                        window.dosbox.module.sendKeyEvent(keyCode, isDown);
                        log(`js-dos direct: ${isDown ? 'keydown' : 'keyup'} ${keyCode}`, 'info');
                    } else {
                        // Fallback - DOM —Å–æ–±—ã—Ç–∏–µ
                        const event = new KeyboardEvent(isDown ? 'keydown' : 'keyup', {
                            keyCode: keyCode,
                            which: keyCode,
                            bubbles: true,
                            cancelable: true
                        });
                        document.dispatchEvent(event);
                        log(`DOM fallback: ${isDown ? 'keydown' : 'keyup'} ${keyCode}`, 'info');
                    }
                } else {
                    // Fallback - DOM —Å–æ–±—ã—Ç–∏–µ
                    const event = new KeyboardEvent(isDown ? 'keydown' : 'keyup', {
                        keyCode: keyCode,
                        which: keyCode,
                        bubbles: true,
                        cancelable: true
                    });
                    document.dispatchEvent(event);
                    log(`DOM fallback: ${isDown ? 'keydown' : 'keyup'} ${keyCode}`, 'info');
                }
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–ª–∞–≤–∏—à–∏: ${error.message}`, 'info');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ js-dos API
        function testDosboxAPI() {
            log('–ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å js-dos API...', 'info');
            
            if (window.dosbox) {
                log('‚úÖ window.dosbox –Ω–∞–π–¥–µ–Ω', 'info');
                
                if (window.dosbox.module) {
                    log('‚úÖ window.dosbox.module –Ω–∞–π–¥–µ–Ω', 'info');
                    
                    if (window.dosbox.module.shell) {
                        log('‚úÖ window.dosbox.module.shell –¥–æ—Å—Ç—É–ø–µ–Ω', 'info');
                    } else {
                        log('‚ùå window.dosbox.module.shell –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'info');
                    }
                    
                    if (window.dosbox.module.sendKeyEvent) {
                        log('‚úÖ window.dosbox.module.sendKeyEvent –¥–æ—Å—Ç—É–ø–µ–Ω', 'info');
                    } else {
                        log('‚ùå window.dosbox.module.sendKeyEvent –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'info');
                    }
                } else {
                    log('‚ùå window.dosbox.module –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'info');
                }
            } else {
                log('‚ùå window.dosbox –Ω–µ –Ω–∞–π–¥–µ–Ω', 'info');
            }
            
            updateStatus();
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
        function updateStatus() {
            const statusContent = document.getElementById('status-content');
            let status = '';
            
            if (window.dosbox) {
                status += '<p><strong>Dosbox:</strong> ‚úÖ –ù–∞–π–¥–µ–Ω</p>';
                
                if (window.dosbox.module) {
                    status += '<p><strong>Module:</strong> ‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω</p>';
                    
                    if (window.dosbox.module.shell) {
                        status += '<p><strong>Shell API:</strong> ‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω</p>';
                    } else {
                        status += '<p><strong>Shell API:</strong> ‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω</p>';
                    }
                    
                    if (window.dosbox.module.sendKeyEvent) {
                        status += '<p><strong>SendKeyEvent:</strong> ‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω</p>';
                    } else {
                        status += '<p><strong>SendKeyEvent:</strong> ‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω</p>';
                    }
                } else {
                    status += '<p><strong>Module:</strong> ‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω</p>';
                }
            } else {
                status += '<p><strong>Dosbox:</strong> ‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω</p>';
            }
            
            statusContent.innerHTML = status;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'info');
            
            // –ñ–¥–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ dosbox
            setTimeout(() => {
                if (window.dosbox) {
                    dosboxInstance = window.dosbox;
                    log('Dosbox –Ω–∞–π–¥–µ–Ω –≤ window', 'info');
                }
                
                updateStatus();
                testDosboxAPI();
            }, 1000);
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        document.addEventListener('keydown', function(e) {
            log(`–°–æ–±—ã—Ç–∏–µ keydown: ${e.key} (–∫–æ–¥: ${e.keyCode})`, 'keydown');
        });

        document.addEventListener('keyup', function(e) {
            log(`–°–æ–±—ã—Ç–∏–µ keyup: ${e.key} (–∫–æ–¥: ${e.keyCode})`, 'keyup');
        });
    </script>
</body>
</html>
