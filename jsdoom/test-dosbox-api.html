<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç js-dos API</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #111;
            color: #f80;
            padding: 20px;
            margin: 0;
        }
        
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.8);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #f80;
        }
        
        h1 {
            text-align: center;
            color: #f80;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 136, 0, 0.1);
            border-radius: 10px;
            border: 1px solid #f80;
        }
        
        .test-section h3 {
            color: #f80;
            margin-top: 0;
        }
        
        .test-button {
            display: inline-block;
            background: #f80;
            color: white;
            text-decoration: none;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .test-button:hover {
            background: #ff6b35;
        }
        
        .log {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #333;
            margin-top: 20px;
        }
        
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        
        .log-entry.info { background: rgba(0, 123, 255, 0.2); }
        .log-entry.success { background: rgba(40, 167, 69, 0.2); }
        .log-entry.warning { background: rgba(255, 193, 7, 0.2); }
        .log-entry.error { background: rgba(220, 53, 69, 0.2); }
        
        .status {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #f80;
        }
        
        .status h4 {
            color: #f80;
            margin-top: 0;
        }
        
        .key-test {
            display: inline-block;
            background: #f80;
            color: #000;
            padding: 10px 20px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            user-select: none;
        }
        
        .key-test:hover {
            background: #ff6b35;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ –¢–µ—Å—Ç js-dos API</h1>
        
        <div class="status">
            <h4>üìä –°—Ç–∞—Ç—É—Å js-dos</h4>
            <div id="status-content">
                <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API...</p>
            </div>
        </div>
        
        <div class="test-section">
            <h3>üîç –ê–Ω–∞–ª–∏–∑ API</h3>
            <div class="test-button" onclick="analyzeDosboxAPI()">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å js-dos API</div>
            <div class="test-button" onclick="testCanvasEvents()">–¢–µ—Å—Ç canvas —Å–æ–±—ã—Ç–∏–π</div>
            <div class="test-button" onclick="testDirectAPI()">–¢–µ—Å—Ç –ø—Ä—è–º–æ–≥–æ API</div>
            <div class="test-button" onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</div>
        </div>
        
        <div class="test-section">
            <h3>üéÆ –¢–µ—Å—Ç –∫–ª–∞–≤–∏—à</h3>
            <div class="key-test" onclick="testKey(38)">‚Üë –í–≤–µ—Ä—Ö (38)</div>
            <div class="key-test" onclick="testKey(40)">‚Üì –í–Ω–∏–∑ (40)</div>
            <div class="key-test" onclick="testKey(37)">‚Üê –í–ª–µ–≤–æ (37)</div>
            <div class="key-test" onclick="testKey(39)">‚Üí –í–ø—Ä–∞–≤–æ (39)</div>
            <div class="key-test" onclick="testKey(17)">Ctrl (17)</div>
            <div class="key-test" onclick="testKey(32)">Space (32)</div>
        </div>
        
        <div class="log" id="log-content">
            <div class="log-entry info">–°–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.</div>
        </div>
    </div>

    <script>
        let logCounter = 0;
        let dosboxInstance = null;

        // –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        function log(message, type = 'info') {
            const logContent = document.getElementById('log-content');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${++logCounter}] ${message}`;
            logContent.appendChild(entry);
            logContent.scrollTop = logContent.scrollHeight;
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –ª–æ–≥–∞
        function clearLog() {
            document.getElementById('log-content').innerHTML = '';
            logCounter = 0;
            log('–õ–æ–≥ –æ—á–∏—â–µ–Ω', 'info');
        }

        // –§—É–Ω–∫—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ js-dos API
        function analyzeDosboxAPI() {
            log('üîç –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º js-dos API...', 'info');
            
            if (window.dosbox) {
                log('‚úÖ window.dosbox –Ω–∞–π–¥–µ–Ω', 'success');
                
                // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É dosbox
                log(`üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ dosbox: ${Object.keys(window.dosbox).join(', ')}`, 'info');
                
                if (window.dosbox.module) {
                    log('‚úÖ window.dosbox.module –Ω–∞–π–¥–µ–Ω', 'success');
                    
                    // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –º–æ–¥—É–ª—å
                    const moduleKeys = Object.keys(window.dosbox.module);
                    log(`üìÅ –ú–µ—Ç–æ–¥—ã –º–æ–¥—É–ª—è: ${moduleKeys.join(', ')}`, 'info');
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã
                    if (window.dosbox.module.shell) {
                        log('‚úÖ window.dosbox.module.shell –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
                        log(`üìÅ Shell –º–µ—Ç–æ–¥—ã: ${Object.keys(window.dosbox.module.shell).join(', ')}`, 'info');
                    }
                    
                    if (window.dosbox.module.sendKeyEvent) {
                        log('‚úÖ window.dosbox.module.sendKeyEvent –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
                    }
                    
                    if (window.dosbox.module.canvas) {
                        log('‚úÖ window.dosbox.module.canvas –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
                        log(`Canvas: ${window.dosbox.module.canvas}`, 'info');
                    }
                    
                    if (window.dosbox.module.ccall) {
                        log('‚úÖ window.dosbox.module.ccall –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
                    }
                    
                } else {
                    log('‚ùå window.dosbox.module –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º Dos object
                if (window.dosbox.Dos) {
                    log('‚úÖ window.dosbox.Dos –Ω–∞–π–¥–µ–Ω', 'success');
                    log(`üìÅ Dos –º–µ—Ç–æ–¥—ã: ${Object.keys(window.dosbox.Dos).join(', ')}`, 'info');
                }
                
            } else {
                log('‚ùå window.dosbox –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
            }
            
            updateStatus();
        }

        // –§—É–Ω–∫—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è canvas —Å–æ–±—ã—Ç–∏–π
        function testCanvasEvents() {
            log('üéØ –¢–µ—Å—Ç–∏—Ä—É–µ–º canvas —Å–æ–±—ã—Ç–∏—è...', 'info');
            
            if (window.dosbox && window.dosbox.module && window.dosbox.module.canvas) {
                const canvas = window.dosbox.module.canvas;
                log(`Canvas –Ω–∞–π–¥–µ–Ω: ${canvas}`, 'info');
                
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ
                const event = new KeyboardEvent('keydown', {
                    keyCode: 38,
                    which: 38,
                    bubbles: true,
                    cancelable: true,
                    code: 'ArrowUp'
                });
                
                try {
                    canvas.dispatchEvent(event);
                    log('‚úÖ –°–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ canvas', 'success');
                } catch (error) {
                    log(`‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ canvas: ${error.message}`, 'error');
                }
                
            } else {
                log('‚ùå Canvas –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä—è–º–æ–≥–æ API
        function testDirectAPI() {
            log('üéØ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä—è–º–æ–π API...', 'info');
            
            if (window.dosbox && window.dosbox.module) {
                // –¢–µ—Å—Ç 1: shell API
                if (window.dosbox.module.shell && window.dosbox.module.shell.sendKeyEvent) {
                    try {
                        window.dosbox.module.shell.sendKeyEvent(38, true);
                        log('‚úÖ Shell API: keydown 38', 'success');
                        
                        setTimeout(() => {
                            try {
                                window.dosbox.module.shell.sendKeyEvent(38, false);
                                log('‚úÖ Shell API: keyup 38', 'success');
                            } catch (e) {
                                log(`‚ùå Shell API keyup error: ${e.message}`, 'error');
                            }
                        }, 100);
                        
                    } catch (error) {
                        log(`‚ùå Shell API error: ${error.message}`, 'error');
                    }
                }
                
                // –¢–µ—Å—Ç 2: –ø—Ä—è–º–æ–π sendKeyEvent
                if (window.dosbox.module.sendKeyEvent) {
                    try {
                        window.dosbox.module.sendKeyEvent(38, true);
                        log('‚úÖ Direct API: keydown 38', 'success');
                        
                        setTimeout(() => {
                            try {
                                window.dosbox.module.sendKeyEvent(38, false);
                                log('‚úÖ Direct API: keyup 38', 'success');
                            } catch (e) {
                                log(`‚ùå Direct API keyup error: ${e.message}`, 'error');
                            }
                        }, 100);
                        
                    } catch (error) {
                        log(`‚ùå Direct API error: ${error.message}`, 'error');
                    }
                }
                
                // –¢–µ—Å—Ç 3: Dos object
                if (window.dosbox.Dos && window.dosbox.Dos.sendKeyEvent) {
                    try {
                        window.dosbox.Dos.sendKeyEvent(38, true);
                        log('‚úÖ Dos API: keydown 38', 'success');
                        
                        setTimeout(() => {
                            try {
                                window.dosbox.Dos.sendKeyEvent(38, false);
                                log('‚úÖ Dos API: keyup 38', 'success');
                            } catch (e) {
                                log(`‚ùå Dos API keyup error: ${e.message}`, 'error');
                            }
                        }, 100);
                        
                    } catch (error) {
                        log(`‚ùå Dos API error: ${error.message}`, 'error');
                    }
                }
                
            } else {
                log('‚ùå Dosbox –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª–∞–≤–∏—à
        function testKey(keyCode) {
            log(`üéÆ –¢–µ—Å—Ç–∏—Ä—É–µ–º –∫–ª–∞–≤–∏—à—É: ${keyCode}`, 'info');
            
            if (window.dosbox && window.dosbox.module) {
                // –ü—ã—Ç–∞–µ–º—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã
                let success = false;
                
                // –ú–µ—Ç–æ–¥ 1: shell API
                if (window.dosbox.module.shell && window.dosbox.module.shell.sendKeyEvent) {
                    try {
                        window.dosbox.module.shell.sendKeyEvent(keyCode, true);
                        log(`üöÄ Shell API: keydown ${keyCode}`, 'success');
                        success = true;
                        
                        setTimeout(() => {
                            try {
                                window.dosbox.module.shell.sendKeyEvent(keyCode, false);
                                log(`üöÄ Shell API: keyup ${keyCode}`, 'success');
                            } catch (e) {
                                log(`‚ùå Shell API keyup error: ${e.message}`, 'error');
                            }
                        }, 100);
                        
                    } catch (e) {
                        log(`‚ùå Shell API error: ${e.message}`, 'error');
                    }
                }
                
                // –ú–µ—Ç–æ–¥ 2: –ø—Ä—è–º–æ–π API
                if (!success && window.dosbox.module.sendKeyEvent) {
                    try {
                        window.dosbox.module.sendKeyEvent(keyCode, true);
                        log(`üöÄ Direct API: keydown ${keyCode}`, 'success');
                        success = true;
                        
                        setTimeout(() => {
                            try {
                                window.dosbox.module.sendKeyEvent(keyCode, false);
                                log(`üöÄ Direct API: keyup ${keyCode}`, 'success');
                            } catch (e) {
                                log(`‚ùå Direct API keyup error: ${e.message}`, 'error');
                            }
                        }, 100);
                        
                    } catch (e) {
                        log(`‚ùå Direct API error: ${e.message}`, 'error');
                    }
                }
                
                // –ú–µ—Ç–æ–¥ 3: canvas —Å–æ–±—ã—Ç–∏—è
                if (!success && window.dosbox.module.canvas) {
                    try {
                        const canvas = window.dosbox.module.canvas;
                        const event = new KeyboardEvent('keydown', {
                            keyCode: keyCode,
                            which: keyCode,
                            bubbles: true,
                            cancelable: true
                        });
                        canvas.dispatchEvent(event);
                        log(`üöÄ Canvas event: keydown ${keyCode}`, 'success');
                        success = true;
                        
                        setTimeout(() => {
                            try {
                                const upEvent = new KeyboardEvent('keyup', {
                                    keyCode: keyCode,
                                    which: keyCode,
                                    bubbles: true,
                                    cancelable: true
                                });
                                canvas.dispatchEvent(upEvent);
                                log(`üöÄ Canvas event: keyup ${keyCode}`, 'success');
                            } catch (e) {
                                log(`‚ùå Canvas keyup error: ${e.message}`, 'error');
                            }
                        }, 100);
                        
                    } catch (e) {
                        log(`‚ùå Canvas API error: ${e.message}`, 'error');
                    }
                }
                
                if (!success) {
                    log(`‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–ª–∞–≤–∏—à—É ${keyCode}`, 'error');
                }
                
            } else {
                log('‚ùå Dosbox –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
        function updateStatus() {
            const statusContent = document.getElementById('status-content');
            let status = '';
            
            if (window.dosbox) {
                status += '<p><strong>Dosbox:</strong> ‚úÖ –ù–∞–π–¥–µ–Ω</p>';
                
                if (window.dosbox.module) {
                    status += '<p><strong>Module:</strong> ‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω</p>';
                    
                    if (window.dosbox.module.shell) {
                        status += '<p><strong>Shell API:</strong> ‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω</p>';
                    } else {
                        status += '<p><strong>Shell API:</strong> ‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω</p>';
                    }
                    
                    if (window.dosbox.module.sendKeyEvent) {
                        status += '<p><strong>SendKeyEvent:</strong> ‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω</p>';
                    } else {
                        status += '<p><strong>SendKeyEvent:</strong> ‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω</p>';
                    }
                    
                    if (window.dosbox.module.canvas) {
                        status += '<p><strong>Canvas:</strong> ‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω</p>';
                    } else {
                        status += '<p><strong>Canvas:</strong> ‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω</p>';
                    }
                } else {
                    status += '<p><strong>Module:</strong> ‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω</p>';
                }
                
                if (window.dosbox.Dos) {
                    status += '<p><strong>Dos Object:</strong> ‚úÖ –ù–∞–π–¥–µ–Ω</p>';
                } else {
                    status += '<p><strong>Dos Object:</strong> ‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω</p>';
                }
            } else {
                status += '<p><strong>Dosbox:</strong> ‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω</p>';
            }
            
            statusContent.innerHTML = status;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'info');
            
            // –ñ–¥–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ dosbox
            setTimeout(() => {
                if (window.dosbox) {
                    dosboxInstance = window.dosbox;
                    log('Dosbox –Ω–∞–π–¥–µ–Ω –≤ window', 'info');
                }
                
                updateStatus();
                analyzeDosboxAPI();
            }, 1000);
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        document.addEventListener('keydown', function(e) {
            log(`–°–æ–±—ã—Ç–∏–µ keydown: ${e.key} (–∫–æ–¥: ${e.keyCode})`, 'keydown');
        });

        document.addEventListener('keyup', function(e) {
            log(`–°–æ–±—ã—Ç–∏–µ keyup: ${e.key} (–∫–æ–¥: ${e.keyCode})`, 'keyup');
        });
    </script>
</body>
</html>
